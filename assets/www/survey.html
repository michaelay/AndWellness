<html>
<head>
   <meta name="viewport" content="height=device-height,width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=no;" />
   <link rel="stylesheet" href="http://m.ucla.edu/assets/css.php" type="text/css">
</head>
<body>

<h1 id="header" class="header center">
   <!--button style="float:left;margin-top:2px;height:30px;">Home</button-->
   AndWellness
</h1>

<h1 class="center" id="desc-title"></h1>
<div id="survey">
</div>
<!--
<div id="survey">
   <div class="content-full content-padded">
      <h1 id="desc-title"></h1>
      <p id="desc-content"></p>
   </div>
   <a id="begin-button" href="#" class="button-full button-light button-padded">Begin</a>
</div>
-->
<a class="button-full button-padded" href="surveylist.html">survey list</a>

<script src="http://m.ucla.edu/assets/js.php"></script>
<script src="js/jquery-1.6.1.min.js"></script>
<script src="js/aws_campaign.js"></script>
<script src="js/aws_utility.js"></script>
<script>
// multiple survey with id like survey1, survey2, survey3, ...
   var onClickNext = function(surveyID) { 
      var surveyFormID = "survey"+surveyID;
      var surveyButtonID = "surveyButton"+surveyID

      var nextID = surveyID + 1; 
      var $nextSurvey = $("#survey > #survey" + nextID);
      if ($nextSurvey) { 
         var $nextButton = $("#survey > #surveyButton" + nextID);
         var $currentSurvey = $("#survey > #survey" + surveyID);
         var $currentButton = $("#survey > #surveyButton" + surveyID);
         $nextSurvey.show();
         $nextButton.show();
         $currentSurvey.hide();  
         $currentButton.hide();  
      } 
   };
   var onClickPrev = function(surveyID) { 
      var surveyFormID = "survey"+surveyID;
      var surveyButtonID = "surveyButton"+surveyID

      var prevID = surveyID + 1; 
      if (surveyID > 1) { 
         var $prevSurvey = $("#survey > #survey" + prevID);
         var $prevButton = $("#survey > #surveyButton" + prevID);
         var $currentSurvey = $("#survey > #survey" + surveyID);
         var $currentButton = $("#survey > #surveyButton" + surveyID);
         $prevSurvey.show();
         $prevButton.show();
         $currentSurvey.hide();  
         $currentButton.hide();  
      } 
   }; 

$(document).ready(function() { 

   var loader = new CampaignXMLLoader(); 
   var xmlString = loader.loadDefaultCampaign(); 

   var id = $.getUrlVars()['id'];
   id = id.replace(/#$/, '');
   var $survey = $(xmlString).find("surveys > survey > id:contains('"+id+"')").parent();
   var $surveyEl = $("#survey");
   $("#desc-title").html($survey.find("title_t").text());
   $("#desc-content").html($survey.find("description").text());

   var currentSurveyID = 1; 
   $survey.find("contentList").children().each(function() {
      var promptText = $(this).find("promptText").text();
      var promptType = $(this).find("promptType").text();
      var survey_displayType = null; 
      var survey_displayLabel = null; 
      var survey_unit = null; 
      var survey_id = null; 
      var survey_promptText = null; 
      var survey_abbreviatedText = null; 
      var survey_explanationTExt = null; 
      var survey_promptType = null; 
      var $survey_properties = null; 
      var survey_default = null; 
      var survey_condition = null; 
      var survey_skippable = null; 
      var survey_skipLabel = null; 
      // parse each children, put them in variables 
      $(this).children().each(function() { 
         switch (this.nodeName.toLowerCase()) { 
         case "displaytype": 
            survey_displayType = $(this).text();
            break; 
         case "displaylabel": 
            survey_displayLabel = $(this).text();
            break; 
         case "unit": 
            survey_unit = $(this).text();
            break; 
         case "id": 
            survey_id = $(this).text(); 
            break; 
         case "prompttext": 
            survey_promptText = $(this).text();
            break; 
         case "abbreviatedtext": 
            survey_abbreviatedText = $(this).text();
            break; 
         case "explanationText": 
            survey_explanationText = $(this).text();
            break; 
         case "prompttype": 
            survey_promptType = $(this).text();
            break; 
         case "properties": 
            $survey_properties = $(this);
            break; 
         case "default": 
            survey_default = $(this).text();
            break; 
         case "condition": 
            survey_condition = $(this).text();
            break; 
         case "skippable": 
            survey_skippable = $(this).text();
            break; 
         case "skiplabel": 
            survey_skipLabel = $(this).text();
            break; 
         // default case is to ignore
         }
      }); 

      // construct HTML based on promptType 
      var surveyID = "survey"+currentSurveyID;
      var surveyButtonID = "surveyButton"+currentSurveyID

      var newFormHTML = '\
      <form class="form-full form-padded">\
         <h1 class="light form-first">'+ survey_promptText +'</h1>\
      ';

      switch (survey_promptType) { 
      case "timestamp": 
         newFormHTML += '<label>timestamp</label>';
         break; 
      case "number": 
         var min;
         var max;
         //newFormHTML += '<label>number</label>';
         newFormHTML += '<select>\n';
         $survey_properties.children("property").each(function() { 
            var label = $(this).find("label").text();
            var value = $(this).find("value").text();
            var key = $(this).find("key").text(); 
            if (key == "min") { 
               min = (value?value:label);
            } else if (key == "max") { 
               max = (value?value:label);
            } 
         });
         for (var i=min; i<=max; i++) { 
            newFormHTML += '<option value="'+i+'">'+i+'</option>\n';
         } 
         newFormHTML += '</select>\n';
         break; 
      case "hours_before_now": 
         newFormHTML += '<label>hours_before_now</label>';
         break; 
      case "text": 
         //newFormHTML += '<label>text</label>';
         var min; 
         var max; 
         $survey_properties.children("property").each(function() { 
            var label = $(this).find("label").text();
            var value = $(this).find("value").text();
            var key = $(this).find("key").text(); 
            if (key == "min") { 
               min = (value?value:label);
            } else if (key == "max") { 
               max = (value?value:label);
            } 
         });
         newFormHTML += '<textarea></textarea>\n';
         break; 
      case "multi_choice": 
      case "multi_choice_custom": 
         //newFormHTML += '<label>multi_choice</label>';
         newFormHTML += '<ul class=".center" style="list-style:none;">';
         $survey_properties.children("property").each(function() { 
            var choiceKey = $(this).find("key").text(); 
            var choiceLabel = $(this).find("label").text();
            var choiceValue = $(this).find("value").text();
            newFormHTML += '<li class=".center" style="float:right;width:48%;">\
                            <input type="checkbox" name="choice" value="'+choiceValue+'" />\
                            <label>' + choiceLabel + '</label>\
                            </li>\n';
         });
         newFormHTML += '<li style="clear:both;"></li>\
                         </ul>';
         break; 
      case "single_choice": 
      case "single_choice_custom": 
         //newFormHTML += '<label>single_choice</label>';
         newFormHTML += '<ul class=".center" style="list-style:none;">';
         $survey_properties.children("property").each(function() { 
            var choiceKey = $(this).find("key").text(); 
            var choiceValue = $(this).find("value").text();
            var choiceLabel = $(this).find("label").text();
            newFormHTML += '<li class=".center" style="float:right;width:48%;">\
                            <input type="radio" name="choice" value="'+choiceValue+'" />\
                            <label>' + choiceLabel + '</label>\
                            </li>\n';
         });
         newFormHTML += '<li style="clear:both;"></li>\
                         </ul>';
         break; 
      case "photo": 
         newFormHTML += '<label>photo</label>';
         break; 
      default: 
         newFormHTML += '<label>Unknown prompt type</label>';
         break;
      } 

      newFormHTML += '\
      </form>';

      var newButtonHTML = '\
      <div class="button-full button-padded">\
         <a class="button-first" href="#" id="prev'+currentSurveyID+'" onClick="onClickPrev('+currentSurveyID+')">Previous</a>\
         <a class="button-last" href="#" id="next'+currentSurveyID+'" onClick="onClickNext('+currentSurveyID+')">Next</a>\
      </div>';

      $newForm = $(newFormHTML);
      $newForm.attr("id", surveyID);

      $newButton = $(newButtonHTML); 
      $newButton.attr("id", surveyButtonID);

      if (currentSurveyID != 1) { 
         $newForm.hide();
         $newButton.hide();
      }

      $surveyEl.append($newForm);
      $surveyEl.append($newButton);

      currentSurveyID++;
   });
});
</script>

</body>
</html>
