<html>
<head>
   <meta name="viewport" content="height=device-height,width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=no;" />
   <link rel="stylesheet" href="http://m.ucla.edu/assets/css.php" type="text/css">
	<script src="http://m.ucla.edu/assets/js.php"></script>
	<script src="js/jquery-1.6.1.min.js"></script>
	<script src="js/aws_campaign.js"></script>
	<script src="js/aws_utility.js"></script>
	<script src="js/aws_auth.js"></script>
	<script src="js/jquery.cookie.js"></script>
	<script src="plugin/LocationTrigger.js"></script>
	<script>
	function location_trigger(){
	
	var loader = new CampaignXMLLoader(); 
   	var xmlString = loader.loadDefaultCampaign(); 

   	// print out the titles 
   	$(xmlString).find("survey").each(function() { 
      var title = $(this).children("title_t").text();
      var id = $(this).children("id").text();
      $("#survey-list").append('<li><input type=checkbox id=\"surveys\" name=\"surveys\" value=' + id + ' />'+title+'</li>'); 
   	});
   	$("#survey-list:last-child").addClass("menu-last");
		
	var locationtrigger = new LocationTrigger();
	locationtrigger.getAll(
	function(r){
	var cat_list = "<ol>";
	for(i=0;i<r.triggers.length;i++){
	cat_list = cat_list + "<li><input type=radio id=\"category\" name=\"category\" value=" + r.triggers[i].category + " checked />" + r.triggers[i].category + "</li>";
	}
	cat_list = cat_list + "<li class= \"menu-last\"><a href=\"manage_loc.html\">Manage Locations</a></li>";
	cat_list= cat_list + "</ol>";
	document.getElementById("category-list").innerHTML=cat_list;
	}
	,
	function(e){
	confirm(e);
	}
			
	);	
	}
	
	function submit(){
	
	/*
	var dataObj = {
               category: "1231212132",
               survey_id: ["asfas"]
              };
	*/
	
	var category = document.getElementById("category").value; 
	var survey_id = [];
    $("#survey-list").find('input:checkbox:checked').each(function() {
    	  survey_id.push($(this).val());
            });
        
    var dataString = {category:category,survey_id:survey_id};
    
    var dataObj = JSON.stringify(dataString);
    
    var locationtrigger = new LocationTrigger();
    
    locationtrigger.set(dataObj,
    function(r){
    confirm("Location Trigger added");    
    },
  	function(e){
	confirm("Could not add Location Trigger");
	}    
    );
	
	}
	
	</script>
</head>
<body onLoad="location_trigger()">
<h1 id="header" class="header center">AndWellness</h1>
<div class="menu-full menu-detailed menu-padded">
   <h1 class="light form-first">Trigger Location</h1>
   <div id="category-list"></div>
</div>
<div class="menu-full menu-detailed menu-padded">
   <h1 class="light form-first">Surveys</h1>
   <ol id="survey-list"></ol>
</div>
<div class="button-full button-padded">
    <a href="createnew.html" class="button-first" onClick="submit()">Done</a>
    <a href="createnew.html" class="button-last">Cancel</a>
</div>

<a href="index.html" class="button-full button-padded" onclick="logout()">Logout</a>
<script src="http://m.ucla.edu/assets/js.php"></script>
<script>
$(document).ready(function() { if (getLogin() == null) { window.location.replace("index.html"); }});
</script>
</body>
</html>
